services:
  tokio_php_embed:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - LISTEN_ADDR=0.0.0.0:8080
      - RUST_LOG=tokio_php=info
      # PHP_WORKERS: number of PHP worker processes (0 = auto-detect from CPU cores)
      - PHP_WORKERS=${PHP_WORKERS:-0}
      # USE_STUB: set to 1 or true to disable PHP and return empty responses
      - USE_STUB=${USE_STUB:-0}
      # PROFILE: set to 1 or true to enable profiling (requires X-Profile: 1 header)
      - PROFILE=${PROFILE:-1}
      # USE_SAPI: set to 1 or true to use custom SAPI executor
      - USE_SAPI=${USE_SAPI:-0}
    volumes:
      - ./www:/var/www/html:ro
    restart: unless-stopped

  tokio_php_sapi:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8081:8080"
    environment:
      - LISTEN_ADDR=0.0.0.0:8080
      - RUST_LOG=tokio_php=info
      # PHP_WORKERS: number of PHP worker processes (0 = auto-detect from CPU cores)
      - PHP_WORKERS=${PHP_WORKERS:-0}
      # USE_STUB: set to 1 or true to disable PHP and return empty responses
      - USE_STUB=${USE_STUB:-0}
      # PROFILE: set to 1 or true to enable profiling (requires X-Profile: 1 header)
      - PROFILE=${PROFILE:-1}
      # USE_SAPI: set to 1 or true to use custom SAPI executor
      - USE_SAPI=${USE_SAPI:-1}
    volumes:
      - ./www:/var/www/html:ro
    restart: unless-stopped
